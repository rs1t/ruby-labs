// get data from controller		контроль в консоли
const imageData = '<%= raw @image_data %>';
const valuesQty = '<%= @image_data[:values_qty] %>';
$('.left_controls span.total_values h2.total').append().html(valuesQty);

// show theme
const selectedTheme = '<%= @image_data[:theme] %>';

if (selectedTheme == "Выберите тему для оценки" ||
    selectedTheme == "Select theme to leave your answer" ||
    selectedTheme == "") {
    $('.img-left-side').css({"display": "none"});
    $('.img-right-side').css({"display": "none"});
    $('.image .image_display .image_diag').css({"display": "none"});
} else {
    $('.img-left-side').css({"display": "block"});
    $('.img-right-side').css({"display": "block"});
    $('.image .image_display .image_diag').css({"display": "block"});
}

$('.image_display h2.up-theme').append().html(selectedTheme);

//restore button
$('.select_theme').empty().html("<%= j render 'work/button_theme_select' -%>");

// get data from controller
let imageCurrentIndex = '<%= @image_data[:index] %>';
let oneImageName = '<%= @image_data[:name] %>';
let oneImageFile = '<%= @image_data[:file] %>';
const themeImagesSize = '<%= @image_data[:images_arr_size] %>';
const selectedThemeId = '<%= @image_data[:theme_id] %>';


// show name of image
$('.image_display h2.up').append().html(oneImageName);

// show image
$(".img-center").attr({title: "Selected image"});
$(".img-center img").attr({alt: "Selected Image", src: oneImageFile, title: "Selected image"});


$('.img-right-side').click(function (event) {
    event.stopImmediatePropagation();

    $.ajax({
        type: "get",
        url: "api/next_image",
        data: {
            index: imageCurrentIndex,
            theme_id: selectedThemeId,
            length: themeImagesSize
        },
        dataType: 'json'
    }).done(function (data_return) {
        imageCurrentIndex = data_return.new_image_index;
        oneImageName = data_return.name;
        oneImageFile = data_return.file;
        $('.image_display h2.up').append().html(oneImageName);
        $(".img-center").attr({title: "Selected image"});
        $(".img-center img").attr({
            alt: "Selected Image", src:
            oneImageFile, title: "Selected image"
        });
    }).fail(function (data_return) {
        console.log("error: data_return = " + data_return);
    });
});


$('.img-left-side').click(function (event) {
    event.stopImmediatePropagation();

    $.ajax({
        type: "get",
        url: "api/prev_image",
        data: {
            index: imageCurrentIndex,
            theme_id: selectedThemeId,
            length: themeImagesSize
        },
        dataType: 'json'
    }).done(function (data_return) {
        imageCurrentIndex = data_return.new_image_index;
        oneImageName = data_return.name;
        oneImageFile = data_return.file;
        $('.image_display h2.up').append().html(oneImageName);
        $(".img-center").attr({title: "Selected image"});
        $(".img-center img").attr({
            alt: "Selected Image", src:
            oneImageFile, title: "Selected image"
        });
    }).fail(function (data_return) {
        console.log("error: data_return = " + data_return);
    });
});

